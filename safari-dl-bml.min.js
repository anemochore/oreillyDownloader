javascript:(async()=>{const url=window.location;if(url.search.startsWith("?scrape=finished")){await heyLoad("https://raw.githubusercontent.com/Stuk/jszip/master/dist/jszip.min.js","JSZip");const zip=new JSZip,consts=await GM_getValue("consts"),BOOK_DIR=consts.BOOK_TITLE.replace(/[/\\?%*:|"<>]/g,"_"),qObj=await GM_getValue("q");for(let[e,t]of Object.entries(qObj)){if(!(e.endsWith(".html")||e.endsWith(".xhtml")||e.endsWith(".htm")||e.endsWith(".css"))){const r=await fetch(t);t=await r.blob()}zip.folder(BOOK_DIR).file(e,t)}async function heyLoad(url,varToTest=!0){let response;try{response=handleErrors(await fetch(url))}catch(e){return console.warn(url,"cannot be loaded due to:",e),null}let txt=await response.text(),se=document.createElement("script");return se.type="text/javascript",se.text=txt,document.getElementsByTagName("head")[0].appendChild(se),eval(varToTest);function handleErrors(e){if(!e.ok)throw Error(e.statusText);return e}}zip.generateAsync({type:"blob"}).then((e=>{const t=document.createElement("a");t.href=window.URL.createObjectURL(e),t.download=`${BOOK_DIR}.zip`,t.click()}))}else{if(url.search.startsWith("?scrape="))return void alert("탬퍼멍키 스크립트가 실행 중인 듯? 다시 실행하려면 주소에서 ?scrape=... 부분을 떼어보세요.");{const a="https://learning.oreilly.com",s=url.href.match(new RegExp((a+"/library/view/").replace(/\//g,"\\/").replace(/\./g,"\\.")+"(.+)/(\\d{13})/$"));if(url.hash||url.search||!s)return void alert("please run on "+a+"/library/view/TITLE/ISBN/");url.replace(url.href+"?scrape=start")}}})();